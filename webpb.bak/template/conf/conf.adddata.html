<!doctype html>
<html>
<head>
	<meta charset="UTF-8"/>
	<title>测试配置-通用性能测试平台</title>
	<link href="/static/css/style.css" rel="stylesheet" type="text/css">
	<script src="/static/js/jquery-1.9.0.js"></script>
	<script src="/static/js/common.js" type="text/javascript"></script>
	<script src="/static/js/model/cycle/jquery.cycle.all.js" type="text/javascript"></script>
	
	<link rel="stylesheet" href="/static/css/bootstrap.css" media="screen">
	<link rel="stylesheet" href="/static/css/scojs.css" media="screen">
	<link rel="stylesheet" href="/static/css/buttons.css">
	<link rel="stylesheet" type="text/css" href="/static/css/main-list.css">
	<link rel="stylesheet" type="text/css" href="/static/css/api.css">
	<link rel="stylesheet" type="text/css" href="/static/css/public.css">
	<link rel="stylesheet" type="text/css" href="/static/css/gy_css.css">

	<link rel="stylesheet" type="text/css" href="/static/css/index.css">
	<link rel="stylesheet" type="text/css" href="/static/css/about.css">
	<link rel="stylesheet" type="text/css" href="/static/css/my.css">

	<script type="text/javascript" src="/static/js/jquery-1.9.0.js"></script>
	<script type="text/javascript" src="/static/js/jquery.easing.1.3.js"></script>
	<script type="text/javascript" src="/static/js/bootstrap.js"></script>
	<script type="text/javascript" src="/static/js/sprintf.min.js"></script>
	<script type="text/javascript" src="/static/js/help_panel.js"></script>

	<script type="text/javascript" src="/static/js/model/uploadify/jquery.uploadify.js"></script>
	<link rel="stylesheet" type="text/css" href="/static/js/model/uploadify/uploadify.css" />
	<!--<script type="text/javascript" src="/static/js/upload.js"></script>-->


	<link href="/static/css/hellotab.css" rel="stylesheet" type="text/css"/>
	<link href="/static/css/helloaddtab.css" rel="stylesheet" type="text/css"/>
	
	<script type="text/javascript" src="/static/js/model/dialog/ui.js"></script>
	<link rel="stylesheet" type="text/css" href="/static/js/model/dialog/ui.css" />
	<style type="text/css">
		#file_upload_1-button {
			font-size:14px;
			font-weight:normal;
		}
    </style>
</head>
<body>
	<!--标题栏-->
	<div class="header">
		<div class="h_logo"><a href="/pb/" title="通用性能测试平台"><img src="/static/images/qaup_logo.png" alt=""/></a></div>
		<div class="h_nav">
			<span><span id='id_user_name'>{{usrname}}</span>, 欢迎您</span>&nbsp;&nbsp;&nbsp;<span><a href="#"><i class="icon16 icon16-setting"></i>个人中心</a></span>&nbsp;&nbsp;&nbsp;<span><a href="/pb/logout/"><i class="icon16 icon16-power"></i>退出</a></span>
		</div>
	</div>
	
	<!--菜单栏-->
	<div class="nav">
		<ul>
			<li><a href="/pb/">首页</a></li>
			<li><a href="/pb/test/?testtype=testpjt">项目测试</a></li>
			<li class="active"><a href="/pb/conf/?conftype=testsrv">测试配置</a></li>
			<li><a href="/pb/stat/">使用统计</a></li>
			<li><a href="#">帮助</a></li>
		</ul>
	</div>
	
	<div class="content_about">
		<div class="container about_container main-content">
			<div style="position:absolute;width:120px;left:0px;top:0px;bottom:0px;background-color:#fbfbfb;z-index:1">
				<ul style="width:100%;font-family:Microsoft YaHei">
					<li class="left-menu-li-select"><a href="/pb/conf/?conftype=adddata" style="color:#000;font-size:medium">添加测试数据</a></li>
				</ul>
				<!--<div style="position:absolute;left:0;bottom:0;top:163px;width:100%;border-right:1px solid #e8e8e8"></div>-->
			</div>
			
			<div class="div-content">
				<table style="margin-bottom:20px;margin-left:30px;margin-top:25px">
					<tr height=50>
						<td valign=top width=70>数据类型<span style="color:red">*</span></td>
						<td valign=top >
							<select id="id_datatype" style="border-radius:0px" onchange="javascript:dis_upload_onselect();">
								<option value="proto文件">proto文件</option>
								<option value="pb性能测试数据">pb性能测试数据</option>
								<option value="pb功能测试用例">pb功能测试用例</option>
								<option value="http性能测试数据">http性能测试数据</option>
								<option value="http功能测试用例">http功能测试用例</option>
							</select>
						</td>
					</tr>
					<tr height=50>
						<td valign=top width=70>数据名称<span style="color:red">*</span></td>
						<td valign=top ><input id="id_dataname" type="text" style="border-radius:0px;height:30px" placeholder="如：proto文件001"></input></td>
						<td valign=top ><input id="strTokenHeToId" type="text" style="display:none;" value=""></input></td>
					</tr>
					<tr height=50>
						<td valign=top width=70>归 属<span style="color:red">*</span></td>
						<td valign=top><input id="id_databelong" disabled="disabled" style="border-radius:0px;height:30px" value={{usrname}}></input></td>
					</tr>
					<tr height=100>
						<td valign=top width=40>描 述</td>
						<td valign=top><textarea id="id_datadesc" style="width:560px;height:70px;border-radius:0px" placeholder="测试数据描述信息"></textarea></td>
					</tr>
					
					<tr height=100>
						<td valign=top width=70>测试数据<span style="color:red">*</span></td>
						<td>
							<div id="fileQueue"></div>
							<div style="float:left;margin-top:10px;">
								<input type="file" name="file_upload_1" id="file_upload_1" /> 
							</div>
							<div style="float:left;margin-left:20px;margin-top:20px;">
								<a href="javascript:$('#file_upload_1').uploadify('cancel','*');"><b>全部取消</b></a>
							</div>
							<!--<div style="float:left;margin-left:50%;font-size:18px;font-weight:bold;">
								<a href="javascript:$('#file_upload_1').uploadify('upload','*')">开始上传</a>&nbsp;&nbsp;|&nbsp;&nbsp;
								<a href="javascript:$('#file_upload_1').uploadify('cancel','*');">全部取消</a>
							</div>-->
						</td>
					</tr>
					<tr height=50>
						<td valign=top width=1>&nbsp;</td>
						<td align=center><div id="id_loading" style="display:none;"><img src="/static/loading.gif"/><br/>上传中 , 请稍候...</div></td>
					</tr>
					<tr>
						<td></td>
						<td colspan=2><button id="id_add" class="global-btn-style" onclick="javascript:add_testdata();">添加</button>
						&nbsp;<button id="id_back" class="global-btn-style" onclick="window.location.href='/pb/conf/?conftype=testdata';">返回</button></td>
					</tr>
				</table>
			</div>
		</div>
	</div>
	
	<!--<div id="id_loading" style="position:absolute;top:50%;left:50%;display:none"><img src="/static/loading.gif"/><br/>上传中 , 请稍候...</div>-->
	<div class="home_foot" style="float:left;">
		<p>Copyright ©2014 Baidu. All Rights Reserved.
		</p>
		<p>
		百度 LBS 测试 版权所有
		</p>
	</div>

	<!-- show_message_area是必须的哦 -->
	<div id="show_message_area"></div>
	<script type="text/javascript">
		$(function() {
			dis_upload_onselect();
		});
		function dis_upload_onselect() {
			var obj=document.getElementById('id_datatype');
			var index=obj.selectedIndex;
			//alert(index);
			if (index == 0) {
				dis_upload('*.proto', '请选择proto类型文件', '选择proto文件...', true);
			} else if (index == 1) {
				dis_upload('*.*', '', '选择pb性能测试数据...', false);
			} else if (index == 2) {
				dis_upload('*.*', '', '选择pb功能测试用例...', false);
			} else if (index == 3) {
				dis_upload('*.*', '', '选择http性能测试数据...', false);
			} else if (index == 4) {
				dis_upload('*.*', '', '选择http功能测试用例...', false);
			}
		}
		function dis_upload(fileTypeExts, fileTypeDesc, buttonText, multi) {
			$("#file_upload_1").uploadify({
				height        : 30,
				swf           : '/static/js/model/uploadify/uploadify.swf',
				uploader      : '/pb/upload_testdata/',
				queueID       : 'fileQueue',
				folder        : 'UploadFile',
				width         : 240,
				auto          : false,
				fileTypeExts  : fileTypeExts,
				fileTypeDesc  : fileTypeDesc,
				buttonText    : buttonText,
				hideButton    : true,
				multi         : multi,
				cancelImg     : '/static/js/model/uploadify/uploadify-cancel.png',
				/*onUploadStart : function(file) {
					//alert(document.getElementById('id_datatype').selectedIndex);
					//alert($('#id_dataname').val());
					$('#file_upload_1').uploadify('settings','formData',{
						'type': document.getElementById('id_datatype').selectedIndex,
						'name': $('#id_dataname').val(),
						'belong': $('#id_databelong').val(),
						'desc': $('#id_datadesc').val()
					});
				},*/
				onUploadStart : function(queueData) {
					//MessageBox('warning', '正在上传，请稍候...');
					document.getElementById('id_loading').style.display = "block"; 
				},
				onQueueComplete : function(queueData) {
					//MessageBox('warning', '添加成功');
					document.getElementById('id_loading').style.display = "none"; 
					options = {
						'onClickYes':function(){location.href = "/pb/conf/?conftype=adddata";},
						'onClickNo':function(){location.href = "/pb/conf/?conftype=testdata";}
					};
					MessageBox('confirm', "添加成功，是否继续添加？", '确认', options);
				}
			});
		}
		function add_testdata() {
			var type=document.getElementById('id_datatype').selectedIndex;
			var name=$('#id_dataname').val();
			var belong=$('#id_databelong').val();
			var desc=$('#id_datadesc').val();
			var filenum=$(".uploadify-queue-item").length;
			var last_id;
			if (name == "" || belong == "") {
				//alert("请输入必填项");
				MessageBox('warning', '请输入必填项');
				return false;
			} else {
				$.ajax({
					type: "post",//使用post方法访问后台
					dataType: "json",//返回json格式的数据
					url: "/pb/add_testdata/",//要访问的后台地址
					contentType: "application/json; charset=utf-8",
					cache: false,
					async: false,
					data: {type:type,name:name,belong:belong,filenum:filenum,desc:desc},//要发送的数据
					//start : function(){},
					//complete :function(){$("#load").hide();},//AJAX请求完成时隐藏loading提示
					success: function(data){//msg为返回的数据，在这里做数据绑定
						if (data.errcode == 1) {
							//MessageBox('warning', '添加成功');
							last_id=data.last_id;
						} else {
							MessageBox('warning', '添加失败');
						}
					}
				});
			}
			//开始上传
			$('#file_upload_1').uploadify('settings','formData',{
				'last_id': last_id
			});
			$('#file_upload_1').uploadify('upload','*');
		}
	</script>
</body>
</html>
